<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title> I learn to C and adjust the brightness -  keshaB Paudel, Python Developer from Nepal</title>
        <link rel="stylesheet" href="/p/style.css">
    </head>
    <body>
        <div class="container">
            <div class="head">
                
                    <h1>I learn to C and adjust the brightness </h1>
                    <div class="preamble">
                        A small C application to adjust brightness of a Lenovo running ArchLinux
                        
                            <a href="/">[Table of Contents]</a>
                        
                    </div>
                
            </div>
            <div class="content">
<div class="post-detail">
    <div class="post-subtitle">2017-12-22 / Kathmandu, Nepal</div>
    <p>I have ArchLinux installed on my work laptop, a Lenovo machine.
One thing that has been a constant bother is adjusting the brightness.
It is desirable to adjust the brightness as the day progresses.</p>

<p>Somehow, the provided hot keys did not work and I have to resort to updating
the <code>/sys/class/backlight/intel_backlight/brightness</code> file manually. I could
tried to fix the hotkeys but haven't gotten around to doing that yet, as I am
not very familiar with that side of linux administration. I am sure I will
get around to doing it some day.</p>

<p>At first, I used to run the <code>tee</code> command from my bash history, which I grew tired
of very soon.
Then I wrote the function below and put it in a <code>.sh</code> file. I would run this everytime after booting.</p>

<div class="codehilite"><pre><span></span><code>bright <span class="o">(){</span>
    <span class="c1"># set the screen brightness</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$#</span><span class="s2">&quot;</span> -eq  <span class="s2">&quot;0&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">ness</span><span class="o">=</span><span class="m">450</span>
    <span class="k">else</span>
        <span class="nv">ness</span><span class="o">=</span><span class="nv">$1</span>
    <span class="k">fi</span>
    sudo tee /sys/class/backlight/intel_backlight/brightness <span class="o">&lt;&lt;&lt;</span> <span class="nv">$ness</span>
<span class="o">}</span>
</code></pre></div>

<p>Then last week, I started dabbling with some C. I realized that I could implement something similar in C
that would help me adjust the brightness and teach me the language. I know that this problem can
be solved much easily without writing a C program. But, where's the fun in that?</p>

<p>Here is the the C code that I put together in about an hour.</p>

<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>

<span class="cm">/* Adjust brightness in lenevo ideapad</span>

<span class="cm">`./bright` Print current brightness</span>
<span class="cm">`sudo ./bright &lt;number&gt;` Set the brightness to any arbitrary number</span>
<span class="cm">`sudo ./bright d` Set brightness to 300 (for the day)</span>
<span class="cm">`sudo ./bright n` Set brightness to 150 (for the night)</span>

<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">cx</span><span class="p">){</span>

  <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">brightness</span><span class="p">;</span>
  <span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span><span class="p">;</span>

  <span class="kt">char</span> <span class="n">filepath</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;/sys/class/backlight/intel_backlight/brightness&quot;</span><span class="p">;</span>


  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Current brightness: &quot;</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">((</span><span class="n">count</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">){</span>
    <span class="n">putchar</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Need to run this as root!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">cx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;d&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
      <span class="n">brightness</span> <span class="o">=</span> <span class="s">&quot;300&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">cx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;n&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">brightness</span> <span class="o">=</span> <span class="s">&quot;150&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">brightness</span> <span class="o">=</span> <span class="n">cx</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">brightness</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Successfully set brightness to: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">brightness</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>This is the first time that I have written something
useful in the C language. This gave me a significant sense of satisfaction.</p>

<p>One thing I want to improve is to check the current time and adjust brightness
accordingly if called without an argument. I'll leave that exercise for the future.</p>

</div>
</div>
            <div class="footer">
                
                    <a href="/">Home</a> | <a target="_blank" href="https://github.com/poudel">Github</a> | <a href="/sitemaps.xml">Sitemaps</a> | Since 2017
                
            </div>
        </div>
    </body>
</html>